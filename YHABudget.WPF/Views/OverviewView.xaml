<UserControl x:Class="YHABudget.WPF.Views.OverviewView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:YHABudget.WPF.Views"
             xmlns:converters="clr-namespace:YHABudget.WPF.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="1000"
             Background="{StaticResource BackgroundLightBrush}">
    <UserControl.Resources>
        <converters:DecimalToBrushConverter x:Key="DecimalToBrushConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="30">
            <Grid Margin="0,0,0,20">
                <TextBlock Text="칐versikt"
                           Style="{StaticResource SectionHeaderStyle}"/>
                <!-- Month Selector and Refresh Button -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center">
                    <Button Content="游댃"
                            Command="{Binding LoadDataCommand}"
                            Style="{StaticResource IconButtonStyle}"
                            ToolTip="Uppdatera"
                            Width="36"
                            Height="36"
                            Margin="0,0,10,0"
                            FontSize="16"/>
                    <TextBlock Text="M친nad:"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"
                               FontSize="14"/>
                    <ComboBox Width="180"
                              Height="32"
                              ItemsSource="{Binding AvailableMonths}"
                              SelectedValue="{Binding SelectedMonth, Mode=TwoWay}"
                              SelectedValuePath="Date"
                              DisplayMemberPath="DisplayName"
                              IsSynchronizedWithCurrentItem="False"
                              MaxDropDownHeight="300"
                              VerticalContentAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- Account Balance -->
            <Border Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource PrimaryBrush}"
                    BorderThickness="2"
                    CornerRadius="4"
                    Padding="20"
                    Margin="0,0,0,20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <TextBlock Text="Kontosaldo"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding AccountBalance, StringFormat='{}{0:N0} kr'}"
                                   HorizontalAlignment="Right"
                                   FontSize="32"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource PrimaryBrush}"/>
                    </Grid>

                    <!-- Expected balance for current month -->
                    <Grid Grid.Row="1"
                          Margin="0,8,0,0"
                          Visibility="{Binding IsCurrentMonth, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="F칬rv칛ntat saldo vid m친nadens slut"
                                   FontSize="14"
                                   FontStyle="Italic"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding ExpectedAccountBalance, StringFormat='{}{0:N0} kr'}"
                                   HorizontalAlignment="Right"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   FontStyle="Italic"
                                   Foreground="{Binding ExpectedAccountBalance, Converter={StaticResource DecimalToBrushConverter}}"/>
                    </Grid>

                    <!-- Actual balance at month end for past months -->
                    <Grid Grid.Row="2"
                          Margin="0,8,0,0"
                          Visibility="{Binding IsPastMonth, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="Saldo vid m친nadens slut"
                                   FontSize="14"
                                   FontStyle="Italic"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding ExpectedAccountBalance, StringFormat='{}{0:N0} kr'}"
                                   HorizontalAlignment="Right"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   FontStyle="Italic"
                                   Foreground="{Binding ExpectedAccountBalance, Converter={StaticResource DecimalToBrushConverter}}"/>
                    </Grid>
                </Grid>
            </Border>

            <!-- Main Summary Card -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <!-- Income and Expenses in Two Columns -->
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Income Column -->
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Inkomster"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource IncomeBrush}"
                                       Margin="0,0,0,8"/>
                            <ItemsControl ItemsSource="{Binding IncomeByCategory}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,3">
                                            <TextBlock Text="{Binding CategoryName}"
                                                       FontSize="13"
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                            <TextBlock Text="{Binding Total, StringFormat='{}{0:N0} kr'}"
                                                       HorizontalAlignment="Right"
                                                       FontSize="13"
                                                       FontWeight="SemiBold"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Separator Margin="0,8"/>
                            <Grid>
                                <TextBlock Text="Totalt"
                                           FontWeight="Bold"
                                           FontSize="14"/>
                                <TextBlock Text="{Binding TotalIncome, StringFormat='+ {0:N0} kr'}"
                                           HorizontalAlignment="Right"
                                           Foreground="{StaticResource IncomeBrush}"
                                           FontWeight="Bold"
                                           FontSize="15"/>
                            </Grid>

                            <!-- Scheduled Income -->
                            <StackPanel Margin="0,12,0,0"
                                        Visibility="{Binding IsCurrentMonth, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Kommande"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           FontStyle="Italic"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <ItemsControl ItemsSource="{Binding ScheduledIncomeTransactions}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,2">
                                                <TextBlock FontSize="12"
                                                           Foreground="{StaticResource TextSecondaryBrush}">
                                                    <Run Text="{Binding Description, Mode=OneWay}"/>
                                                    <Run Text="췅"
                                                         Foreground="{StaticResource DividerBrush}"/>
                                                    <Run Text="{Binding Date, StringFormat='d MMM', Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="{Binding Amount, StringFormat='{}{0:N0} kr'}"
                                                           HorizontalAlignment="Right"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource IncomeBrush}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <Grid Margin="0,4,0,0">
                                    <TextBlock Text="Summa kommande"
                                               FontSize="12"
                                               FontStyle="Italic"/>
                                    <TextBlock Text="{Binding ScheduledIncome, StringFormat='+ {0:N0} kr'}"
                                               HorizontalAlignment="Right"
                                               FontSize="12"
                                               FontStyle="Italic"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource IncomeBrush}"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>

                        <!-- Expenses Column -->
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Utgifter"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource ExpenseBrush}"
                                       Margin="0,0,0,8"/>
                            <ItemsControl ItemsSource="{Binding ExpensesByCategory}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,3">
                                            <TextBlock Text="{Binding CategoryName}"
                                                       FontSize="13"
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                            <TextBlock Text="{Binding Total, StringFormat='{}{0:N0} kr'}"
                                                       HorizontalAlignment="Right"
                                                       FontSize="13"
                                                       FontWeight="SemiBold"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Separator Margin="0,8"/>
                            <Grid>
                                <TextBlock Text="Totalt"
                                           FontWeight="Bold"
                                           FontSize="14"/>
                                <TextBlock Text="{Binding TotalExpenses, StringFormat='- {0:N0} kr'}"
                                           HorizontalAlignment="Right"
                                           Foreground="{StaticResource ExpenseBrush}"
                                           FontWeight="Bold"
                                           FontSize="15"/>
                            </Grid>

                            <!-- Scheduled Expenses -->
                            <StackPanel Margin="0,12,0,0"
                                        Visibility="{Binding IsCurrentMonth, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <TextBlock Text="Kommande"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           FontStyle="Italic"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           Margin="0,0,0,4"/>
                                <ItemsControl ItemsSource="{Binding ScheduledExpenseTransactions}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,2">
                                                <TextBlock FontSize="12"
                                                           Foreground="{StaticResource TextSecondaryBrush}">
                                                    <Run Text="{Binding Description, Mode=OneWay}"/>
                                                    <Run Text="췅"
                                                         Foreground="{StaticResource DividerBrush}"/>
                                                    <Run Text="{Binding Date, StringFormat='d MMM', Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="{Binding Amount, StringFormat='{}{0:N0} kr'}"
                                                           HorizontalAlignment="Right"
                                                           FontSize="12"
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource ExpenseBrush}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <Grid Margin="0,4,0,0">
                                    <TextBlock Text="Summa kommande"
                                               FontSize="12"
                                               FontStyle="Italic"/>
                                    <TextBlock Text="{Binding ScheduledExpenses, StringFormat='- {0:N0} kr'}"
                                               HorizontalAlignment="Right"
                                               FontSize="12"
                                               FontStyle="Italic"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource ExpenseBrush}"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Grid>

                    <!-- Expected Month Result (only for current month) -->
                    <Border Background="{StaticResource PrimaryLightBrush}"
                            CornerRadius="4"
                            Padding="15"
                            Visibility="{Binding IsCurrentMonth, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <TextBlock Text="F칬rv칛ntat m친nadsresultat"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding ExpectedMonthResult, StringFormat='{}{0:N0} kr'}"
                                       HorizontalAlignment="Right"
                                       VerticalAlignment="Center"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{Binding ExpectedMonthResult, Converter={StaticResource DecimalToBrushConverter}}"/>
                        </Grid>
                    </Border>

                    <!-- Actual Month Result (only for past months) -->
                    <Border Background="{StaticResource PrimaryLightBrush}"
                            CornerRadius="4"
                            Padding="15"
                            Visibility="{Binding IsPastMonth, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0">
                                <TextBlock Text="M친nadsresultat"
                                           FontSize="16"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding ExpectedMonthResult, StringFormat='{}{0:N0} kr'}"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center"
                                           FontSize="24"
                                           FontWeight="Bold"
                                           Foreground="{Binding ExpectedMonthResult, Converter={StaticResource DecimalToBrushConverter}}"/>
                            </Grid>

                            <Grid Grid.Row="1"
                                  Margin="0,8,0,0">
                                <TextBlock Text="Saldo vid m친nadens slut"
                                           FontSize="14"
                                           FontStyle="Italic"
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Text="{Binding ExpectedAccountBalance, StringFormat='{}{0:N0} kr'}"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           FontStyle="Italic"
                                           Foreground="{Binding ExpectedAccountBalance, Converter={StaticResource DecimalToBrushConverter}}"/>
                            </Grid>
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
